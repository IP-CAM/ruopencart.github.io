---
layout: ru-ru/default
title: "Система событий - Документация OpenCart"
permalink: ru-ru/developer/events_system/
---
<h1>Система событий</h1>
<h2>Что такое файл событий?</h2>
<p>После выпуска OpenCart v2.2 + в ядро был добавлен новый движок. Событие - это встроенный механизм, разработанный Software Management, для запуска автоматизированных задач либо от администратора, либо от внешнего интерфейса платформы.</p>
<h2>Что делает файл событий?</h2>
<p>Событие завершает задачи, которые:</p>
<ul>
  <li>контроллер</li>
  <li>модель</li>
  <li>переопределение темы</li>
  <li>язык</li>
  <li>конфиг</li>
</ul>
<p>необходимо выполнять на серверной стороне магазина.</p>
<h2>В каком сценарии должен быть разработан файл событий?</h2>
<p>Владелец магазина может захотеть предоставлять рекламные функции покупателям или получать уведомления по электронной почте, которые ядро ​​специально не предоставляет «из коробки».</p>
<p>Один из запросов на обслуживание, о котором владельцы магазинов могут часто публиковать, - это отправка внутренних уведомлений, когда клиенты заполняют информацию во время оформления заказа. Событие может выполнить задачу, захватив ожидаемые результаты во время проверки почти неограниченных возможностей.</p>
<p>Один сценарий будет о добавлении товара в магазин со страницы администратора->каталог->товары. Как мы все должны знать, к настоящему времени основные файлы никогда не должны редактироваться. Однако файлы событий могут быть захвачены до или после того, как произошло какое-либо действие, что означает, что основные файлы больше не нужно редактировать в хранилище.</p>
<h2>Какие файлы обрабатывают инициированные события?</h2>
<p>Файл `system/engine/event.php` - это основной файл Engine, в котором все события вызываются после инициирования события в таблице базы данных oc_event с активным состоянием. Этот файл движка может делать следующее:</p>
<ul>
  <li>Зарегистрировать триггер и действие</li>
  <li>Запустить событие и аргументы</li>
  <li>Отменить регистрацию триггера и маршрута</li>
  <li>Очистить триггер</li>
</ul>
<h2>Как триггеры, действия и порядок сортировки инициируются автоматически в каталоге?</h2>
<p>Файлы `admin/controller/startup/event.php` и `catalog/controller/startup/event.php` являются обоими местоположениями, где триггеры, действия и порядки сортировки автоматически регистрируются Engine при запуске. Папки `admin/controller/event` и `catalog/controller/event` являются основными событиями, инициируемыми автоматически по умолчанию после успешной установки Opencart.</p>
<h2>Что такое код?</h2>
<p>Код - это технический идентификационный тег или заголовок, который определяет цель его использования. Пример похож на страницу `admin->catalog->products` с мета-заголовками, но в более технических терминах.</p>
<h2>Что такое триггер?</h2>
<p>Триггер - это определенный маршрут от источника, где либо; контроллер, модель, язык или тема могут быть запрошены из. Например, один сценарий, когда владельцу магазина может потребоваться указать триггер в отношении информационных бюллетеней, которые необходимо отправлять определенным группам покупателей. Модель запрашивается, но, либо ** до ** или ** после ** загрузки этой модели завершается, владелец магазина может захотеть добавить один или несколько аспектов, чтобы уведомить своих клиентов во время выполнения триггерного источника. из локальной базы данных или от надежного поставщика услуг.</p>
<h2>Что такое действие?</h2>
<p>Действие - это определенный маршрут к месту назначения, из которого исходный маршрут должен отправить уведомление о событии. Например, путем создания модуля расширения в папках admin/controller/extension/module или в папках catalog/controller/extension/module необходимо назначить имя метода вместе с местоположением маршрута.</p>
<p>Например:</p>
<ul>
  <li>admin/controller/extension/module/your_module.php будет содержать имя метода: notify ()</li>
</ul>
<p>Определенное действие, полученное от Engine, затем инициирует это конкретное действие, полученное триггером, чтобы завершить запрос в электронном виде.</p>
<h2>Что такое поле состояния?</h2>
<p>Поле состояния - это то, что определяет активность определенного события.</p>
<h2>Что означает порядок сортировки?</h2>
<p>Поле порядка сортировки определяет приоритет события перед его инициацией. Он не имеет отношения к событию <b>до</b> или <b>после</b>. Он просто описывает задачу упорядочения на основе точки зрения списка заданий.</p>
<h2>Какие параметры необходимо добавить при создании экземпляра события в модуле расширения?</h2>
<p>При инициировании события before необходимо ввести два параметра. Следуя примеру с методом notify (), два параметра будут следующими:</p>
<ul>
  <li>$route: происходит от запроса маршрута (route = x). Он также может быть передан как ссылочная переменная.</li>
  <li>$args: скалярный массив, использующий индексные числа, полученные из источника. Например, при добавлении записи заказа в историю: $this->model_checkout_order->addOrderHistory($order_id, $order_status_id). Он также может быть передан как ссылочная переменная.</li>
</ul>
<p>В этом случае скалярный массив $args будет содержать: $args[0] (order_id), $args[1] (order_status_id). Дополнительную информацию можно найти в catalog/controller/mail/order.php, в котором находятся уведомления о заказе по электронной почте между владельцем магазина и покупателем.</p>
<p>При инициировании последующего события есть три параметра, которые необходимо ввести. Следуя примеру с методом notify (), третий параметр будет:</p>
<ul>
  <li>$output: вывод уникального индекса из скалярного массива. Например, было создано переопределение события, и выходной результат можно вывести из исходных кодов файла темы и просмотреть в браузере. Он также может быть передан как ссылочная переменная.</li>
</ul>
<h2>Каков наилучший способ проверить результаты с последующим событием?</h2>
<p>В файле system / config / catalog.php в нижней части файла по умолчанию комментируются ключ отладки и значение в массиве, поскольку они должны быть активны только для целей отладки. После активации отладки коды можно проверить в файле catalog / controller / event / debug.php. Настоятельно рекомендуется отменить изменения в файле system / config / catalog.php после завершения теста. Если хранилище работает в режиме реального времени, рекомендуется также установить хранилище в режиме обслуживания из меню администратора -> системы -> настройки -> изменить настройки -> вкладка сервера -> режим обслуживания: включено до завершения испытаний.</p>
<h2>Где можно следить за событиями?</h2>
<p>События можно отслеживать на странице admin -> extensions -> events.</p>
<h2>Как начать планирование модуля расширения?</h2>
<p>На стороне администратора и на стороне каталога события выполняются независимо. Это означает, что события, создаваемые на стороне администратора, также не отражают события, созданные на стороне каталога. Они оба бегут отдельно. Обе стороны событий могут бегать по-своему, не мешая друг другу.</p>
<h2>Контроллер в модель (CTAM) - Пример кода - Инициирование события перед</h2>
<p>Далее приведен пример кода, который может быть инициирован как событие before , из контроллера, чтобы вызвать модель, в данном случае, для автоматической обработки продуктов, со ссылочными переменными в параметрах метода, в admin / controller / extension / module Файл /product_notification.php (необходимо создать):</p>
<p><code>&lt;?php
class ControllerExtensionModuleProductNotification extends Controller {
    // admin/model/catalog/product/addProduct/before
    public function addProduct($route, $args) {
        $this->load->model('catalog/product');

        // While the product being added, we add the next statement below by loading the catalog product model
        // by using the route (optional) and the scalar array of $args.
    }
}</code></p>
<p>Тот же метод можно использовать с последующим событием, просто заменив:</p>
<p><code>// admin/model/catalog/product/addProduct/before
public function addProduct($route, $args) {</code></p>
<p>с:</p>
<p><code>// admin/model/catalog/product/addProduct/after
public function addProduct($route, $args, $output) {</code></p>
<h3>Заметка</h3>
<p>Начиная с выпуска Opencart, v2.2 и выше, система событий была обновлена, так что к контроллерам, моделям, представлениям, языку и конфигурации может быть присоединено событие. В предыдущих версиях только данные модели могли быть переопределены.</p>
<h2>Регистрация Ваших событий</h2>
<p>Когда Ваш модуль установлен, Вы захотите зарегистрировать все события, которые нужны Вашему скрипту.</p>
<h3>Загрузите модель</h3>
<p><code>$this->load->model('setting/event');</code></p>
<h3>Зарегистрируйте свое событие</h3>
<p><code>$this->model_setting_event->addEvent($code, $trigger, $action);</code></p>
<ul>
  <li>
    Инициировать событие до .
    <code>$this->model_setting_event->addEvent('product_notification', 'admin/model/catalog/product/addProduct/before',
    'extension/module/product_notification/addProduct');</code>
  </li>
  <li>
    Чтобы инициировать последующее событие, просто измените его на:
    <code>$this->model_setting_event->addEvent('product_notification', 'admin/model/catalog/product/addProduct/after', 'extension/module/product_notification/addProduct');</code>
  </li>
</ul>
<h2>Темы</h2>
<h4>Код</h4>
<p>Код должен быть уникальным кодом, уникальным только для Ваших расширений. Вы можете использовать свое имя пользователя OpenCart, а затем имя расширения.</p>
<h4>пример</h4>
<p><code>username_theme</code></p>
<p>Код также используется для удаления события, которое Вы добавили, если пользователь решит удалить Ваше расширение.</p>
<h4>Триггер</h4>
<p>Триггер - это вызов, выполняемый для вызываемого или загружаемого контроллера, модели, представления, языка или файла конфигурации.</p>
<p>Триггер состоит из множества частей:</p>
<p><code>application / type / folder / file / method / before or after</code></p>
<h4>Применение</h4>
<p>Должен быть установлен для каталога или администратора.</p>
<ul>
  <li>контроллер</li>
  <li>модель</li>
  <li>представление</li>
  <li>язык</li>
  <li>конфиг</li>
</ul>
<h4>Папка</h4>
<p>Папка является необязательной в зависимости от того, находится ли путь к загружаемому файлу внутри подпапки или нет.</p>
<h4>Файл</h4>
<p>Имя файла вызывается.</p>
<h4>Метод</h4>
<p>Метод используется только с контроллерами и моделями.</p>
<p>Триггер события, когда вызывается метод контроллера или модели. Контроллеры не всегда требуют метода, но модели требуют.</p>
<h4>Перед/После</h4>
<p>Устанавливает погоду, когда событие запускается до или после загрузки файла или вызова метода.</p>
<h4>Действие</h4>
<p>Действие - это объект, который имеет в своем конструкторе маршрут к вызываемому контроллеру действий. Внутри контроллера Вы можете манипулировать маршрутом, данными, аргументами и возвратом данных контроллера, модели, вызываемого вида.</p>
<h4>Пример</h4>
<p><code>folder/file/method</code></p>
<p>Если метод не установлен, он будет вызывать index.</p>
<h2>Удаление Вашего События</h2>
<p>Когда Ваш модуль будет удален, Вам необходимо убедиться, что Вы удалили все события, которые Вы зарегистрировали.</p>
<h4>Удалить Ваше событие</h4>
<p><code>$this->model_setting_event->deleteEventByCode('my_theme');</code></p>
<h2>Использование событий</h2>
<p>Для использования и события Вы должны:</p>
<ol>
  <li>Установить триггер.</li>
  <li>Убедитесь, что действие (контроллер), вызываемое триггером события, существует.</li>
</ol>
<p>Только контроллеры могут быть вызваны действием. Это означает, что если вы присоединяете действие, которое запускается при вызове события модели, оно может вызывать только контроллер, а не другую модель.</p>
<p>В зависимости от того, вызывается ли загружаемый класс или вызывается контроллером, моделью, представлением, языком или файлом конфигурации, действие должно называться аргументами.</p>
<p>Примеры:</p>
<h4>Контроллер</h4>
<table class="table table-hover">
  <caption>Параметры</caption>
  <thead>
    <tr>
      <td>Таблицы</td>
      <td>Тип</td>
      <td>Описание</td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>$route</code></td>
      <td><code>string</code> (строка)</td>
      <td>получает объект библиотеки по ключу</td>
    </tr>
    <tr>
      <td><code>$data</code></td>
      <td><code>array</code> (массив)</td>
      <td>данные, поступающие в контроллер</td>
    </tr>
  </tbody>
</table>
<p>Возвращает</p>
<p>Если Вы вернете данные, они прекратят любые другие действия события, которые установлены для вызова.</p>
<h4>Модель</h4>
<h5>Параметры (2)</h5>
<p><code>$route</code></p>
<p>Маршрут, который вызывается.</p>
<p><code>$route</code></p>
<p>Данные, поступающие в контроллер.</p>
<p>Возвращает</p>
<p>Если Dы вернете данные, это остановит любые другие действия, которые</p>
<h4>Представление</h4>
<p>Входные параметры</p>
<p>Просмотр загружаемого представления</p>
<p>данные в data</p>
<h4>Язык</h4>
<h5>Параметры</h5>
<p><code>$route</code></p>
<p>Маршрут, который вызывается.</p>
<h4>Конфиг</h4>
<p>В примере мы добавили событие, которое срабатывает при добавлении продукта. Вызываемый файл будет admin / controller /
module / demo.php, а метод внутри класса демо-контроллера будет, eventSendAdminAlert()и если вы хотите добавить событие
во внешний интерфейс (каталог), используйте catalog / controller / module / demo.php</p>
